<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Connect Instagram Demo</title>
    <style>
      body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;max-width:720px;margin:40px auto;padding:0 16px}
      button{font-size:16px;padding:12px 16px;border-radius:10px;border:1px solid #ddd;cursor:pointer}
      .card{border:1px solid #eee;border-radius:12px;padding:16px;margin:16px 0}
      code{background:#f6f6f6;padding:2px 6px;border-radius:6px}
    </style>
  </head>
  <body>
    <h1>Connect Instagram</h1>
    <p>Click the button below to connect your Facebook Page + Instagram account.</p>
    <button onclick="window.location.href='/login'">Connect Instagram</button>

    <div id="result" class="card" style="display:none"></div>
    <script>
      // After callback, the server may redirect to /?status=ok
      const params = new URLSearchParams(window.location.search);
      if (params.get('status') === 'ok') {
        fetch('/whoami').then(r=>r.json()).then(data=>{
          const box = document.getElementById('result');
          box.style.display='block';
          box.innerHTML = `<h3>Connected ✅</h3>
            <p><b>Page:</b> ${data.page?.name} (ID: <code>${data.page?.id}</code>)</p>
            <p><b>Instagram:</b> ${data.instagram?.username || 'not linked'} (ID: <code>${data.instagram?.id || '—'}</code>)</p>`;
        });
      }
    </script>
  </body>
</html>
